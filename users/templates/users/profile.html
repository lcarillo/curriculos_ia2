{% extends 'core/base.html' %}

{% block title %}Meu Perfil - Currículos IA{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-12">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Meu Perfil</h1>
                <button type="button" id="editButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300">
                    Editar Perfil
                </button>
            </div>

            {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-md p-4 mb-2">
                    <div class="text-green-800 dark:text-green-200 text-sm">
                        {{ message }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" class="space-y-6" id="profileForm">
                {% csrf_token %}

                {% if user_form.errors or profile_form.errors %}
                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-md p-4 mb-4">
                    <div class="text-red-800 dark:text-red-200 text-sm">
                        <strong>Erro:</strong> Por favor, corrija os erros abaixo.
                    </div>
                </div>
                {% endif %}

                <!-- Campo Usuário (não editável) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Usuário
                    </label>
                    <input type="text" value="{{ user.username }}" class="form-input" disabled>
                    <input type="hidden" name="username" value="{{ user.username }}">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="{{ user_form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Nome
                        </label>
                        {{ user_form.first_name }}
                        {% if user_form.first_name.errors %}
                        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ user_form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div>
                        <label for="{{ user_form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Sobrenome
                        </label>
                        {{ user_form.last_name }}
                        {% if user_form.last_name.errors %}
                        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ user_form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>

                <div>
                    <label for="{{ user_form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Email
                    </label>
                    {{ user_form.email }}
                    {% if user_form.email.errors %}
                    <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ user_form.email.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ profile_form.phone.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Telefone
                    </label>
                    {{ profile_form.phone }}
                    {% if profile_form.phone.errors %}
                    <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ profile_form.phone.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ profile_form.linkedin_url.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        LinkedIn
                    </label>
                    {{ profile_form.linkedin_url }}
                    {% if profile_form.linkedin_url.errors %}
                    <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ profile_form.linkedin_url.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ profile_form.website_url.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Website
                    </label>
                    {{ profile_form.website_url }}
                    {% if profile_form.website_url.errors %}
                    <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ profile_form.website_url.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Campos hidden para garantir que todos os dados sejam enviados -->
                <input type="hidden" name="first_name" value="{{ user.first_name }}">
                <input type="hidden" name="last_name" value="{{ user.last_name }}">
                <input type="hidden" name="email" value="{{ user.email }}">
                <input type="hidden" name="phone" value="{{ user.profile.phone }}">

                <div class="flex justify-end space-x-4 pt-6" id="saveButtons" style="display: none;">
                    <button type="button" id="cancelButton" class="px-6 py-3 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition duration-300">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300">
                        Salvar Alterações
                    </button>
                </div>
            </form>

            <div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Alterar Senha</h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Para alterar sua senha, utilize a página dedicada para redefinição de senha.
                </p>
                <a href="{% url 'password_reset' %}" class="px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition duration-300">
                    Alterar Senha
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        background-color: #f9fafb;
        color: #6b7280;
    }

    .dark .form-input {
        background-color: #4b5563;
        border-color: #6b7280;
        color: #d1d5db;
    }

    .form-input:focus {
        outline: none;
        ring: 2px;
        ring-color: #3b82f6;
        border-color: #3b82f6;
    }

    .form-input:not([disabled]) {
        background-color: white;
        color: #1f2937;
    }

    .dark .form-input:not([disabled]) {
        background-color: #374151;
        color: #f3f4f6;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editButton = document.getElementById('editButton');
        const cancelButton = document.getElementById('cancelButton');
        const saveButtons = document.getElementById('saveButtons');

        // Apenas os campos LinkedIn e Website podem ser editados
        const linkedinInput = document.querySelector('[name="linkedin_url"]');
        const websiteInput = document.querySelector('[name="website_url"]');

        // Desabilita os campos editáveis inicialmente
        linkedinInput.disabled = true;
        websiteInput.disabled = true;

        editButton.addEventListener('click', function() {
            // Habilita apenas LinkedIn e Website
            linkedinInput.disabled = false;
            websiteInput.disabled = false;

            // Mostra os botões de salvar/cancelar
            saveButtons.style.display = 'flex';

            // Esconde o botão de editar
            editButton.style.display = 'none';
        });

        cancelButton.addEventListener('click', function() {
            // Desabilita os campos editáveis
            linkedinInput.disabled = true;
            websiteInput.disabled = true;

            // Esconde os botões de salvar/cancelar
            saveButtons.style.display = 'none';

            // Mostra o botão de editar
            editButton.style.display = 'block';

            // Recarrega a página para descartar alterações
            location.reload();
        });
    });
</script>
{% endblock %}